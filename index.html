<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成长小账本 | Bloom Diary</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dark-mode.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f8c3cd">
</head>
<body>
    <div id="app">
        <!-- 顶部导航 -->
        <header>
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <h1>成长小账本</h1>
            </div>
            <nav>
                <!-- 调整顺序，设置按钮放在切换主题按钮左侧 -->
                <button id="settings-btn" aria-label="设置" class="icon-btn">
                    <i class="fas fa-cog"></i>
                </button>
                <button id="theme-toggle" aria-label="切换主题" class="icon-btn">
                    <i class="fas fa-moon"></i>
                </button>
            </nav>
        </header>

        <!-- 主内容区 -->
        <main>
            <!-- 每日总览 -->
            <section id="daily-overview">
                <div class="card">
                    <div class="card-header">
                        <h2>今日总览</h2>
                        <span id="current-date"></span>
                    </div>
                    <div class="card-body">
                        <!-- 添加打卡卡片区域 -->
                        <div class="checkin-cards">
                            <div class="checkin-card" id="wakeup-checkin-card">
                                <div class="checkin-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="checkin-info">
                                    <h3>今日起床打卡</h3>
                                    <div id="wakeup-status" class="checkin-status">未打卡</div>
                                    <div id="wakeup-time-display" class="checkin-time hidden"></div>
                                </div>
                                <button id="wakeup-btn" class="primary-btn">打卡</button>
                            </div>
                            
                            <div class="checkin-card" id="sleep-checkin-card">
                                <div class="checkin-icon">
                                    <i class="fas fa-moon"></i>
                                </div>
                                <div class="checkin-info">
                                    <h3>今日睡觉打卡</h3>
                                    <div id="sleep-status" class="checkin-status">未打卡</div>
                                    <div id="sleep-time-display" class="checkin-time hidden"></div>
                                </div>
                                <button id="sleep-btn" class="primary-btn">打卡</button>
                            </div>
                        </div>                        
                        <div class="stats-summary">
                            <div class="stat-item">
                                <i class="fas fa-coins"></i>
                                <span>今日收入: </span>
                                <span id="today-earnings">0</span> 元
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-tasks"></i>
                                <span>任务完成: </span>
                                <span id="today-tasks">0/0</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-clock"></i>
                                <span>学习时间: </span>
                                <span id="today-study">0</span> 分钟
                            </div>
                        </div>
                        
                        <!-- 添加任务完成情况展示区域 -->
                        <div class="completed-tasks-overview">
                            <h3>已完成任务</h3>
                            <div id="overview-tasks-container">
                                <!-- 这里将显示按类别分组的任务 -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 学习计时器 -->
            <section id="study-timer">
                <div class="card">
                    <div class="card-header">
                        <h2>学习计时</h2>
                    </div>
                    <div class="card-body">
                        <div class="timer-display">
                            <span id="timer">00:00:00</span>
                        </div>
                        <div class="timer-controls">
                            <div class="timer-mode">
                                <label>
                                    <input type="radio" name="timer-mode" value="countup" checked> 正计时
                                </label>
                                <label>
                                    <input type="radio" name="timer-mode" value="countdown"> 倒计时
                                </label>
                            </div>
                            <div class="time-presets" id="countdown-options" style="display: none;">
                                <button data-time="5">5分钟</button>
                                <button data-time="10">10分钟</button>
                                <button data-time="15">15分钟</button>
                                <button data-time="30">30分钟</button>
                                <button data-time="45">45分钟</button>
                                <button data-time="60">60分钟</button>
                            </div>
                            <div class="action-buttons">
                                <button id="start-timer" class="primary-btn">开始</button>
                                <button id="pause-timer" class="secondary-btn" disabled>暂停</button>
                                <button id="stop-timer" class="danger-btn" disabled>结束</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 任务系统 -->
            <section id="tasks-section">
                <div class="card">
                    <div class="card-header">
                        <h2>每日任务</h2>
                        <button id="add-task-btn" class="icon-btn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="tabs">
                            <button class="tab-btn active" data-category="身体健康">身体健康</button>
                            <button class="tab-btn" data-category="心理健康">心理健康</button>
                            <button class="tab-btn" data-category="灵魂滋养">灵魂滋养</button>
                            <button class="tab-btn" data-category="自我提升">自我提升</button>
                            <button class="tab-btn" data-category="广结善缘">广结善缘</button>
                            <button class="tab-btn" data-category="custom" id="custom-tab">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                        
                        <div class="tab-content" data-category="心理健康">
                            <div class="tasks-list" id="tasks-心理健康"></div>
                        </div>
                        
                        <div class="tab-content" data-category="灵魂滋养">
                            <div class="tasks-list" id="tasks-灵魂滋养"></div>
                        </div>
                        
                        <div class="tab-content" data-category="自我提升">
                            <div class="tasks-list" id="tasks-自我提升"></div>
                        </div>
                        
                        <div class="tab-content" data-category="广结善缘">
                            <div class="tasks-list" id="tasks-广结善缘"></div>
                        </div>
                        
                        <div class="tab-content" data-category="custom">
                            <div class="custom-categories" id="custom-categories"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 数据统计 -->
            <section id="statistics-section">
                <div class="card">
                    <div class="card-header">
                        <h2>数据统计</h2>
                        <div class="stat-controls">
                            <button class="stat-period active" data-period="day">日</button>
                            <button class="stat-period" data-period="week">周</button>
                            <button class="stat-period" data-period="month">月</button>
                            <button class="stat-period" data-period="year">年</button>
                            <button id="export-data" class="icon-btn" title="导出数据">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-tabs">
                            <button class="chart-tab active" data-chart="income">收入</button>
                            <button class="chart-tab" data-chart="sleep">睡眠</button>
                        </div>
                        <div class="chart-container">
                            <canvas id="daily-chart"></canvas>
                            <canvas id="period-chart" style="display: none;"></canvas>
                            <canvas id="sleep-chart" style="display: none;"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 底部导航 -->
        <footer>
            <nav class="bottom-nav">
                <button class="nav-item active" data-target="daily-overview">
                    <i class="fas fa-home"></i>
                    <span>总览</span>
                </button>
                <button class="nav-item" data-target="study-timer">
                    <i class="fas fa-clock"></i>
                    <span>学习</span>
                </button>
                <button class="nav-item" data-target="tasks-section">
                    <i class="fas fa-tasks"></i>
                    <span>任务</span>
                </button>
                <button class="nav-item" data-target="statistics-section">
                    <i class="fas fa-chart-pie"></i>
                    <span>统计</span>
                </button>
            </nav>
        </footer>
    </div>

    <!-- 模态框 -->
    <div id="modal-overlay" class="hidden">
        <!-- 添加任务模态框 -->
        <div id="add-task-modal" class="modal hidden">
            <div class="modal-header">
                <h3>添加任务</h3>
                <button class="close-modal">×</button>
            </div>
            <div class="modal-body">
                <form id="add-task-form">
                    <div class="form-group">
                        <label for="task-category">任务类别</label>
                        <select id="task-category" required>
                            <option value="身体健康">身体健康</option>
                            <option value="心理健康">心理健康</option>
                            <option value="灵魂滋养">灵魂滋养</option>
                            <option value="自我提升">自我提升</option>
                            <option value="广结善缘">广结善缘</option>
                        </select>
                        <button type="button" id="add-category-btn" class="text-btn">添加自定义类别</button>
                    </div>
                    <div class="form-group">
                        <label for="task-name">任务名称</label>
                        <input type="text" id="task-name" required>
                    </div>
                    <div class="form-group">
                        <label>选择模板</label>
                        <div class="templates-container" id="task-templates"></div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="primary-btn">添加</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 添加类别模态框 -->
        <div id="add-category-modal" class="modal hidden">
            <div class="modal-header">
                <h3>添加自定义类别</h3>
                <button class="close-modal">×</button>
            </div>
            <div class="modal-body">
                <form id="add-category-form">
                    <div class="form-group">
                        <label for="category-name">类别名称</label>
                        <input type="text" id="category-name" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="primary-btn">添加</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 设置模态框 - 确保这个结构存在且正确 -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-header">
                <h3>应用设置</h3>
                <button class="close-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>数据管理</h4>
                    <div class="settings-info">
                        <p>当前数据存储位置：浏览器本地存储(LocalStorage)</p>
                        <p>数据总大小：<span id="data-size">计算中...</span></p>
                    </div>
                    <div class="settings-actions">
                        <button id="export-all-data" class="secondary-btn">
                            <i class="fas fa-download"></i> 导出所有数据
                        </button>
                        <button id="clear-data" class="danger-btn">
                            <i class="fas fa-trash"></i> 清除所有数据
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>打卡设置</h4>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>早起打卡奖励时段：</label>
                            <div class="time-range-inputs">
                                <input type="time" id="early-wake-start-time" value="05:00">
                                <span>至</span>
                                <input type="time" id="early-wake-end-time" value="06:00">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>早睡打卡奖励时段：</label>
                            <div class="time-range-inputs">
                                <input type="time" id="early-sleep-start-time" value="22:00">
                                <span>至</span>
                                <input type="time" id="early-sleep-end-time" value="23:00">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>开发者选项</h4>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="dev-mode-toggle">
                            <span>开发者模式</span>
                        </label>
                        <p class="setting-desc">启用测试功能，方便验证应用流程</p>
                    </div>
                    <div id="dev-options" class="hidden">
                        <button id="add-test-data" class="secondary-btn">
                            <i class="fas fa-plus"></i> 添加测试数据
                        </button>
                        <button id="reset-today" class="warning-btn">
                            <i class="fas fa-redo"></i> 重置今日数据
                        </button>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button id="save-settings" class="primary-btn">保存设置</button>
                </div>
            </div>
        </div>

        <!-- 退出确认模态框 -->
        <div id="exit-confirm-modal" class="modal hidden">
            <div class="modal-header">
                <h3>确定退出学习？</h3>
                <button class="close-modal">×</button>
            </div>
            <div class="modal-body">
                <p>提前结束学习将按8元/小时计算收入，是否确认退出？</p>
                <div class="form-actions">
                    <button id="confirm-exit" class="danger-btn">确认退出</button>
                    <button id="cancel-exit" class="secondary-btn">继续学习</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 脚本加载 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/timer.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/app.js"></script>
    <script>
        // 注册 Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered');
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>